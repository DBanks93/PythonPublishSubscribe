---
services:
  pubsub-emulator:
    container_name: pubsub-emulator
    image: google/cloud-sdk:emulators
    ports:
      - "8085:8085"
    environment:
      - PUBSUB_EMULATOR_HOST=localhost:8085
    command: "/bin/sh -c 'gcloud beta emulators pubsub start --host-port=0.0.0.0:8085 --project=test-project'"

    healthcheck:
      test: [ "CMD", "curl", "--silent", "--fail", "http://localhost:8085/v1/projects/test-projetc/topics" ]
      interval: 30s
      retries: 3
      timeout: 10s
      start_period: 10s


  postgres-database:
    container_name: postgres-database
    image: postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=S3cret
      - POSTGRES_USER=appuser
      - POSTGRES_DB=integration
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U appuser"]
      interval: 10s
      timeout: 5s
      retries: 5

